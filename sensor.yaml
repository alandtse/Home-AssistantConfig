#Weather Sensor:
  - platform: pi_hole
  - platform: cert_expiry
    host: !secret ha_url
  - platform: darksky
    api_key: !secret darksky_key
    monitored_conditions:
      - wind_speed
      - cloud_cover
      - hourly_summary
      - daily_summary  
  - platform: yr
    monitored_conditions:
      - temperature
      - symbol
  - platform: wunderground
    api_key: !secret wunderground_key
    #pws_id: !secret wunderground_pws
    monitored_conditions:
      - weather
      - temp_f
      - pressure_in
      - wind_string
      - relative_humidity
#Time and Date Sensor
  - platform: time_date
    display_options:
      - 'time_date'
#  - platform: plex
#    name: PlexSpy
#    host: wdmycloudmirror
#    port: 32400
#    username: !secret plex_user
#    password: !secret plex_password
#Morning Commute Google Travel Time Sensor
  - platform: google_travel_time
    name: Morning Commute
    api_key: !secret google_key
    origin: !secret add_home
    destination: !secret add_work
#Evening Commute Google Travel Time Sensor
  - platform: google_travel_time
    name: Evening Commute
    api_key: !secret google_key
    origin: !secret add_work
    destination: !secret add_home
  - platform: google_travel_time
    name: Alan to Home
    api_key: !secret google_key
    origin: device_tracker.alandtse_nexus5
    destination: !secret add_home
  - platform: google_travel_time
    name: Ray to Home
    api_key: !secret google_key
    origin: device_tracker.raywtse_note4
    destination: !secret add_home
  - platform: systemmonitor
    resources:
    - type: disk_use
      arg: /
    - type: memory_use_percent
    - type: swap_use_percent
    - type: processor_use
  - platform: template
    sensors:
      downstairsthermmode:
        friendly_name: "Downstairs Away mode"
        value_template: >-
           {%- if  states.climate.downstairs.attributes.away_mode == 'off' -%}
              Home
           {%- elif states.climate.downstairs.attributes.away_mode == 'on' -%}
              Away
           {%- elif states.climate.downstairs != None -%}
              unknown
           {%- endif -%}
      downstairsthermoper:
        friendly_name: "Downstairs Thermostat"
        value_template: >-
           {%- if states.climate.downstairs != None -%}
             {{ states.climate.downstairs.attributes.operation }}
           {%- else -%}
             unknown
           {%- endif -%}
        icon_template: >-
          {%- if states.climate.downstairs.attributes.operation == "heat" -%}
            mdi:fire
          {%- elif states.climate.downstairs.attributes.operation == "cool" -%}
            mdi:snowflake
          {%- else -%}
            mdi:fan
          {%- endif -%}
      upstairshermostatmode:
        friendly_name: "Upstairs Away Mode"
        value_template: >-
           {%- if  states.climate.upstairs.attributes.away_mode == 'off' -%}
              Home
           {%- elif states.climate.upstairs.attributes.away_mode == 'on' -%}
              Away
           {%- elif states.climate.upstairs != None -%}
              unknown
           {%- endif -%}
      upstairsthermostatoperation:
        friendly_name: "Upstairs Thermostat"
        value_template: >-
           {%- if states.climate.upstairs != None -%}
             {{ states.climate.upstairs.attributes.operation }}
           {%- else -%}
             unknown
           {%- endif -%}
        icon_template: >-
          {%- if states.climate.upstairs.attributes.operation == "heat" -%}
            mdi:fire
          {%- elif states.climate.upstairs.attributes.operation ==  "cool" -%}
            mdi:snowflake
          {%- else -%}
            mdi:fan
          {%- endif -%}
      estimated_overage_date:
        friendly_name: "Estimated Date of Overage"
        value_template: >-
           {% set start= (as_timestamp("2017-04-11 00:00:0")) %}
           {% set odometer = states.sensor.tesla_model_s_5yjsa1e13hf192718_mileage_sensor.state|round %}
           {% set end= (as_timestamp("2020-04-11 00:00:0")) %}
           {% set today = as_timestamp(now()) %}
           {% set secondsInDay= 60*60*24 %}
           {% set daysFromStart = ((start- today)/secondsInDay)|int|abs %}
           {% set daysTillEnd = ((end - today)/secondsInDay)|int|abs %}
           {% set totalDays = ((end - start)/secondsInDay)|int|abs %}
           {% set mileageLimit= 30000 %}
           {{((((totalDays * mileageLimit / (odometer/daysFromStart * totalDays) - daysFromStart)) * secondsInDay) + today)| timestamp_local}}
      estimated_final_mileage:
        friendly_name: "Estimated Mileage"
        unit_of_measurement: mi
        value_template: >-
           {% set start= (as_timestamp("2017-04-11 00:00:0")) %}
           {% set odometer = states.sensor.tesla_model_s_5yjsa1e13hf192718_mileage_sensor.state|round %}
           {% set end= (as_timestamp("2020-04-11 00:00:0")) %}
           {% set today = as_timestamp(now()) %}
           {% set secondsInDay= 60*60*24 %}
           {% set daysFromStart = ((start- today)/secondsInDay)|int|abs %}
           {% set daysTillEnd = ((end - today)/secondsInDay)|int|abs %}
           {% set totalDays = ((end - start)/secondsInDay)|int|abs %}
           {% set mileageLimit= 30000 %}
           {{'%0.2f'|format( odometer/daysFromStart * totalDays) }}
      estimated_daily_mileage_limit:
        friendly_name: "Estimated Daily Mileage Limit"
        unit_of_measurement: mi
        value_template: >-
           {% set start= (as_timestamp("2017-04-11 00:00:0")) %}
           {% set odometer = states.sensor.tesla_model_s_5yjsa1e13hf192718_mileage_sensor.state|round %}
           {% set end= (as_timestamp("2020-04-11 00:00:0")) %}
           {% set today = as_timestamp(now()) %}
           {% set secondsInDay= 60*60*24 %}
           {% set daysFromStart = ((start- today)/secondsInDay)|int|abs %}
           {% set daysTillEnd = ((end - today)/secondsInDay)|int|abs %}
           {% set totalDays = ((end - start)/secondsInDay)|int|abs %}
           {% set mileageLimit= 30000 %}
           {{'%0.2f'|format( (mileageLimit - odometer) / daysTillEnd) }}
  - platform: ohmconnect
    id: !secret ohmconnect_id
  - platform: google_geocode
    name: Alan
    origin: device_tracker.alandtse_nexus5
    api_key: !secret google_key
  - platform: google_geocode
    name: Ray
    origin: device_tracker.raywtse_note4
    api_key: !secret google_key
  - platform: google_geocode
    name: Model S
    origin: device_tracker.tesla_model_s_5yjsa1e13hf192718_location_tracker
    api_key: !secret google_key
  - platform: google_geocode
    name: Model 3
    origin: device_tracker.tesla_model_3_5yj3e1ea7hf002153_location_tracker
    api_key: !secret google_key
